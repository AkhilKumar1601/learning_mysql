mysql> SELECT DISTINCT u.user_id, u.name
    -> FROM users u
    -> JOIN orders o 
    ->     ON u.user_id = o.user_id
    -> WHERE NOT EXISTS (
    ->     SELECT 1
    ->     FROM user_activity ua
    ->     WHERE ua.user_id = u.user_id
    -> );
Empty set (0.02 sec)

mysql> SELECT DISTINCT ua.activity_type, COUNT(ua.activity_type) AS count_of_events
    -> FROM user_activity ua;
ERROR 1140 (42000): In aggregated query without GROUP BY, expression #1 of SELECT list contains nonaggregated column 'ecommerce.ua.activity_type'; this is incompatible with sql_mode=only_full_group_by
mysql> SELECT DISTINCE ua.activity_type, COUNT(ua.activity_type) AS count_of_events
    -> FROM user_activity ua
    -> GROUP BY ua.activity_type;
ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '.activity_type, COUNT(ua.activity_type) AS count_of_events
FROM user_activity ua' at line 1
mysql> SELECT ua.activity_type,
    ->        COUNT(*) AS count_of_events
    -> FROM user_activity ua
    -> GROUP BY ua.activity_type;
+---------------+-----------------+
| activity_type | count_of_events |
+---------------+-----------------+
| view          |               3 |
| add_to_cart   |               1 |
| click         |               1 |
+---------------+-----------------+
3 rows in set (0.00 sec)

mysql> SELECT o.order_id 
    -> FROM orders o
    -> JOIN user_activity ua 
    -> ON ua.order_id = o.order_id
    -> WHERE ua.activity_type = "view";
ERROR 1054 (42S22): Unknown column 'ua.order_id' in 'on clause'
mysql> SELECT o.order_id
    -> FROM orders o
    -> JOIN user_activity ua
    -> ON ua.user_id = o.user_id
    -> WHERE ua.activity_type = "view";
+----------+
| order_id |
+----------+
|     1001 |
|     1003 |
|     1002 |
|     1004 |
+----------+
4 rows in set (0.01 sec)

mysql> ^C
mysql> SELECT COUNT(DISTINCT ua.user_id) AS users_who_viewed
    -> FROM user_activity ua
    -> WHERE ua.activity_type = 'view';
+------------------+
| users_who_viewed |
+------------------+
|                3 |
+------------------+
1 row in set (0.01 sec)

mysql> SELECT COUNT(DISTINCT o.user_id) AS users_who_converted
    -> FROM orders o
    -> JOIN user_activity ua
    ->     ON o.user_id = ua.user_id
    -> WHERE ua.activity_type = 'view';
+---------------------+
| users_who_converted |
+---------------------+
|                   3 |
+---------------------+
1 row in set (0.00 sec)

mysql> SELECT
    ->     (COUNT(DISTINCT o.user_id) * 100.0) 
    ->     / COUNT(DISTINCT ua.user_id) AS conversion_rate_percentage
    -> FROM user_activity ua
    -> LEFT JOIN orders o
    ->     ON ua.user_id = o.user_id
    -> WHERE ua.activity_type = 'view';
+----------------------------+
| conversion_rate_percentage |
+----------------------------+
|                  100.00000 |
+----------------------------+
1 row in set (0.00 sec)

mysql> SELECT DISTINCT u.user_id, u.name
    -> FROM users u
    -> JOIN user_activity ua
    ->     ON u.user_id = ua.user_id
    -> WHERE ua.activity_type = 'add_to_cart'
    -> AND NOT EXISTS (
    ->     SELECT 1
    ->     FROM orders o
    ->     WHERE o.user_id = u.user_id
    -> );
Empty set (0.00 sec)

mysql> SELECT user_id, MIN(activity_time) AS first_activity_time
    -> FROM user_activity
    -> GROUP BY user_id;
+---------+---------------------+
| user_id | first_activity_time |
+---------+---------------------+
|       1 | 2023-05-01 10:00:00 |
|       2 | 2023-05-03 12:00:00 |
|       3 | 2023-06-01 14:00:00 |
|       4 | 2023-06-15 16:00:00 |
+---------+---------------------+
4 rows in set (0.01 sec)

mysql> SELECT user_id, MIN(order_date) AS first_order_time
    -> FROM orders
    -> GROUP BY user_id;
+---------+------------------+
| user_id | first_order_time |
+---------+------------------+
|       1 | 2023-05-01       |
|       2 | 2023-05-03       |
|       3 | 2023-06-01       |
|       4 | 2023-06-15       |
+---------+------------------+
4 rows in set (0.01 sec)

mysql> SELECT
    ->     fa.user_id,
    ->     TIMESTAMPDIFF(
    ->         MINUTE,
    ->         fa.first_activity_time,
    ->         fo.first_order_time
    ->     ) AS time_diff_minutes
    -> FROM
    ->     (SELECT user_id, MIN(activity_time) AS first_activity_time
    ->      FROM user_activity
    ->      GROUP BY user_id) fa
    -> JOIN
    ->     (SELECT user_id, MIN(order_date) AS first_order_time
    ->      FROM orders
    ->      GROUP BY user_id) fo
    -> ON fa.user_id = fo.user_id;
+---------+-------------------+
| user_id | time_diff_minutes |
+---------+-------------------+
|       1 |              -600 |
|       2 |              -720 |
|       3 |              -840 |
|       4 |              -960 |
+---------+-------------------+
4 rows in set (0.00 sec)

mysql> notee;
